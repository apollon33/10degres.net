<blockquote>
  <p>There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it? 
Files for this level can be found in /home/flag01.</p>
</blockquote>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;sys types.h=""&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gid_t</span> <span class="n">gid</span><span class="p">;</span>
  <span class="n">uid_t</span> <span class="n">uid</span><span class="p">;</span>

  <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
  <span class="n">uid</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>

  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
  <span class="n">setresuid</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">);</span>

  <span class="n">system</span><span class="p">(</span><span class="s">"/usr/bin/env echo and now what?"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>This program has been compiled and the executable is available in <code class="highlighter-rouge">/home/flag01</code>. 
<!--more-->
Note that it has the famous suid bit again:</p>

<p><a href="/images/exploit_exercices_nebula_level01_1.png"><img src="/images/exploit_exercices_nebula_level01_1.png" alt="Exploit Exercises Nebula Level01" /></a></p>

<p>The goal here is to inject or execute “something” (ie. a shell) by overriding the system command <code class="highlighter-rouge">echo</code>. 
Luckily the program uses <code class="highlighter-rouge">/usr/bin/env</code> which means that it will be sensitive to the environment of the current user including the <code class="highlighter-rouge">PATH</code> variable.</p>

<p>So the first point is to provide our own <code class="highlighter-rouge">echo</code> command:</p>

<p><a href="/images/exploit_exercices_nebula_level01_21.png"><img src="/images/exploit_exercices_nebula_level01_21.png" alt="Exploit Exercises Nebula Level01" /></a></p>

<p>Then add the current directory in the <code class="highlighter-rouge">PATH</code> list:</p>

<p><a href="/images/exploit_exercices_nebula_level01_3.png"><img src="/images/exploit_exercices_nebula_level01_3.png" alt="Exploit Exercises Nebula Level01" /></a></p>

<p>And finally, run the program:</p>

<p><a href="/images/exploit_exercices_nebula_level01_4.png"><img src="/images/exploit_exercices_nebula_level01_4.png" alt="Exploit Exercises Nebula Level01" /></a></p>
