<p>Recently reported by Claudio Viviani, there is an SQL Injection available in this plugin who has been downloaded more than 100k. 
Developped by Apptha (again), the current version 2.7 still vulnerable and downloadable from 
the official <a href="https://wordpress.org/plugins/contus-video-gallery/" title="Wordpress Video Gallery" class="flashlink" target="_blank">Wordpress Plugin Directory</a>.</p>

<p>The hole comes from the lack of filter on the GET parameter <code class="highlighter-rouge">vid</code> in <code class="highlighter-rouge">/wp-content/plugins/contus-video-gallery/videogalleryrss.php</code> (the plugin must be enable to perform the injection):</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>case 'video':
  $thumbImageorder = 'w.vid ASC';
  $vid             = filter_input(INPUT_GET,'vid');
  $where           = 'AND w.vid ='.$vid;
  $TypeOFvideos    = $contusOBJ-&gt;home_thumbdata( $thumbImageorder , $where , $dataLimit );
break;
</code></pre>
</div>

<p>Since there is no filter specified when calling <a href="http://php.net/manual/fr/function.filter-input.php" title="filter_input">filter_input</a>, the default value is used which is <code class="highlighter-rouge">unsafe_raw</code>. 
According to the PHP documentation, <a href="http://php.net/manual/fr/filter.filters.sanitize.php" title="FILTER_UNSAFE_RAW">FILTER_UNSAFE_RAW</a> deletes chars under 32 and over 127 and converts <code class="highlighter-rouge">&amp;</code> to <code class="highlighter-rouge">&amp;amp;</code>.</p>

<!--more-->

<p>Of course, it’s not enough to protect the query crafted in <code class="highlighter-rouge">/wp-content/plugins/contus-video-gallery/front/models/videohome.php</code>:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="err">$</span><span class="n">query</span> <span class="o">=</span> <span class="s1">'SELECT distinct w.*,s.guid,s.ID,p.playlist_name,p.pid,p.playlist_slugname FROM '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_videoinfotable</span> <span class="p">.</span> <span class="s1">' w
LEFT JOIN '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_wpdb</span><span class="o">-&gt;</span><span class="k">prefix</span> <span class="p">.</span> <span class="s1">'hdflvvideoshare_med2play m ON m.media_id = w.vid
LEFT JOIN '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_wpdb</span><span class="o">-&gt;</span><span class="k">prefix</span> <span class="p">.</span> <span class="s1">'hdflvvideoshare_playlist p ON p.pid=m.playlist_id
LEFT JOIN '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_wpdb</span><span class="o">-&gt;</span><span class="k">prefix</span> <span class="p">.</span> <span class="s1">'posts s ON s.ID=w.slug
WHERE w.publish=1 AND p.is_publish=1 '</span> <span class="p">.</span> <span class="err">$</span><span class="k">where</span> <span class="p">.</span> <span class="s1">' GROUP BY w.vid ORDER BY '</span> <span class="p">.</span> <span class="err">$</span><span class="n">thumImageorder</span> <span class="p">.</span> <span class="s1">' LIMIT '</span> <span class="p">.</span> <span class="err">$</span><span class="n">dataLimit</span><span class="p">;</span>
</code></pre>
</div>

<p>Rendered as:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">distinct</span> <span class="n">w</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">guid</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">playlist_name</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">playlist_slugname</span> <span class="k">FROM</span> <span class="n">wp_hdflvvideoshare</span> <span class="n">w</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">wp_hdflvvideoshare_med2play</span> <span class="n">m</span> <span class="k">ON</span> <span class="n">m</span><span class="p">.</span><span class="n">media_id</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">wp_hdflvvideoshare_playlist</span> <span class="n">p</span> <span class="k">ON</span> <span class="n">p</span><span class="p">.</span><span class="n">pid</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">playlist_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">wp_posts</span> <span class="n">s</span> <span class="k">ON</span> <span class="n">s</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">w</span><span class="p">.</span><span class="n">slug</span>
<span class="k">WHERE</span> <span class="n">w</span><span class="p">.</span><span class="n">publish</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="n">p</span><span class="p">.</span><span class="n">is_publish</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span> <span class="o">=</span><span class="mi">234</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span> <span class="k">ASC</span> <span class="k">LIMIT</span> <span class="mi">1000</span>
</code></pre>
</div>

<p>Here is the POC:</p>

<p><a href="/images/wordpress-video-gallery-sqli.png"><img src="/images/wordpress-video-gallery-sqli.png" alt="wordpress video gallery sqli" /></a></p>

<p>Remember that <strong>it’s not the first time that Apptha released a plugin with major vulnerability</strong>. Months ago <a href="http://blog.10degres.net/vulnerability-in-hd-flv-player/" title="HD FLV Player">HD FLV Player</a> was concerned.</p>
