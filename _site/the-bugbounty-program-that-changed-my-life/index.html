<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>The bug bounty program that changed my life &#8211; Gwendal Le Coguic</title>
<meta name="description" content="Gwendal Le Coguic, web developer and security researcher">
<meta name="keywords" content="sqli, xss, subdomain, rce, upload, repository">

<!-- Twitter Cards --><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://10degres.net/images/pp-rce-1.png">
<meta name="twitter:title" content="The bug bounty program that changed my life">
<meta name="twitter:description" content="Gwendal Le Coguic, web developer and security researcher">
<meta name="twitter:creator" content="@gwendallecoguic">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="The bug bounty program that changed my life">
<meta property="og:description" content="Gwendal Le Coguic, web developer and security researcher">
<meta property="og:url" content="http://10degres.net/the-bugbounty-program-that-changed-my-life/">
<meta property="og:site_name" content="Gwendal Le Coguic">
<meta property="og:image" content="http://10degres.net/images/pp-rce-1.png">


<meta name="google-site-verification" content="GnoFwHUV3XNgLy4D-7XjLQ0Dbw6fKBXZnBzMn-0GBX8">



<link rel="canonical" href="http://10degres.net/the-bugbounty-program-that-changed-my-life/">
<link href="http://10degres.net/feed.xml" type="application/atom+xml" rel="alternate" title="Gwendal Le Coguic Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://10degres.net/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://10degres.net/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://10degres.net/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://10degres.net/favicon.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://10degres.net/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://10degres.net/assets/img/me.jpg" alt="Gwen photo" class="author-photo">
					<h4>Gwen</h4>
					<p>Web developer reconverted to security researcher, playing bug bounty sometimes :)</p>
				</li>
				<li><a href="http://10degres.net/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:g@10degres.net"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/gwendallecoguic" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="https://linkedin.com/in/gwendal-le-coguic-77106729" target="_blank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/gwen001" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://10degres.net/posts/">All Posts</a></li>
				<li><a href="http://10degres.net/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  
  <div class="entry-image">
    <img src="http://10degres.net/assets/img/header-background.jpg" alt="The bug bounty program that changed my life">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://10degres.net/the-bugbounty-program-that-changed-my-life/" rel="bookmark" title="The bug bounty program that changed my life">The bug bounty program that changed my life</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2018-02-11T00:00:00+00:00">February 11, 2018</time></span></h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>This is a real story or not, that occured in mid 2017 or not, about a private program or not, on Hackerone or not, believe me or not, but it changed my life.
I would like to thanks all the people from this company I talked with.
They were very nice with me, very fast to fix the bugs and I always got the rewards in less than 7 days, frequently the day of the report, even for the smallest bugs.
Thanks to them, I wish we could find more program like this one.
<!--more--></p>

<p>The money was not the only good thing I earned during this period, my reputation on Hackerone also grew up very fast.
From here I received many private invitations, sometimes 3 or 4, up to 5 a week, and we all know that private programs are very important for hunters.
I also learned alot because it was the very first time that I was able to play with such issues, I mean in real life, not on a training platform, so it was really really formative.</p>

<p>Some people were mad on me because I didn’t want to share my findings in this program.
Come on guys…
Following each others on Twitter doesn’t mean I want/can disclose the details of the issues I found in a private program, specially if you’re also working on…<br />
It would be like cutting the branch of the tree I’m sitting on.
I hope you understand that.<br />
Kisses :)</p>

<h2 id="introduction">Introduction</h2>

<p>Had a hard a time to contact the company, the kool <a href="https://twitter.com/emgeekboy" class="flashlink" target="_blank">@Geekboy</a> helped me to enter in the game, thanks to him.</p>

<p>So I joined with 1 subdomain takeover on Cloudfront and 2 SQL injection on a minor subdomain, not bad at all, promising.</p>

<h2 id="first-hit-well-official-hit">First hit, well, “official” hit…</h2>

<p>A big scan with Dirb on another subdomain revealed a <code class="highlighter-rouge">.git</code> directory.
Using the program <a href="https://github.com/koto/gitpillage" class="flashlink" target="_blank">gitpillage</a>, I got some interesting files:<br />
<a href="/images/pp-git-listing.png"><img src="/images/pp-git-listing.png" alt="Private program git listing" /></a></p>

<p>That could be enough to write a report but since it was PHP code and since I can read PHP, I jumped in the source (PHP guru will recognize the very old Zend Studio 5.5 here xD).
<a href="/images/pp-git-code.png"><img src="/images/pp-git-code.png" alt="Private program git code" /></a></p>

<p>I quickly found some calls to <code class="highlighter-rouge">exec()</code>, that allow a developper to execute system commands.
By tracking the creation of the command string, I had notice that a POST parameter was used without any sanitization.
Simplified, the code looked like this:</p>
<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="nv">$image</span><span class="o">-&gt;</span><span class="na">upload</span><span class="p">(</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'img'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">],</span> <span class="nv">$_POST</span> <span class="p">);</span>

    <span class="k">class</span> <span class="nc">image</span> <span class="p">{</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">upload</span><span class="p">(</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$args</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">create_base_name</span><span class="p">(</span> <span class="nv">$args</span> <span class="p">);</span>
            <span class="nv">$full_path</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">upload_dir</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">base_name</span><span class="p">;</span>
            <span class="nv">$command</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span> <span class="s1">'chmod 777 %s'</span><span class="p">,</span> <span class="nv">$full_path</span> <span class="p">);</span>
            <span class="nb">exec</span><span class="p">(</span> <span class="nv">$command</span> <span class="p">);</span>
        <span class="p">}</span>
    
        <span class="k">private</span> <span class="k">function</span> <span class="nf">create_base_name</span><span class="p">(</span> <span class="nv">$args</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">base_name</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span> <span class="s1">'%s%s%s'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">,</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">'p'</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">suffix</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>What would you try then? RCE natürlich! The PoC:
<a href="/images/pp-rce-1.png"><img src="/images/pp-rce-1.png" alt="Private program rce" /></a></p>

<p>W00t w00t bounty time :)</p>

<h2 id="replay">Replay</h2>

<p>Some weeks later, and some others issues later (CORS/CSRF/source code disclosure/rate limit), another SQL injection popped on the main domain.<br />
<a href="/images/pp-sqli.png"><img src="/images/pp-sqli.png" alt="Private program sqli" /></a></p>

<p>Since I said to the company to take care about the vulnerable module where I found the RCE, 1 month later I came back in the same place and tried to reproduce the bug.
Was fixed, the vulnerable parameter wasn’t anymore.
But what about all others and what about the other scripts in the repository?</p>

<p>KA-CHING! Got 3 more RCE.</p>

<p>One of them required 3 parameters in his input:</p>
<ul>
  <li>path</li>
  <li>filename</li>
  <li>contents</li>
</ul>

<p>This script wrote the content <code class="highlighter-rouge">contents</code> in the file <code class="highlighter-rouge">filename</code> created in the directory <code class="highlighter-rouge">path</code>.
The perfect backdoor. Congrats captain Obvious!</p>

<p><a href="/images/pp-rce-2.png"><img src="/images/pp-rce-2.png" alt="Private program rce" /></a></p>

<h2 id="bouncing-from-a-rce-to-another-rce">Bouncing from a RCE to another RCE</h2>

<p>Is that fair or not? Well I don’t know but while I was “connected” to the server of the company, and since I knew that they have a functionality to handle images,
I checked the version of the library ImageMagick.
<a href="/images/pp-imagetragick-1.png"><img src="/images/pp-imagetragick-1.png" alt="Private program imagetragick" /></a></p>

<p>If you’re hunter you probably already heard about the famous <a href="https://imagetragick.com/" class="flashlink" target="_blank">ImageTragick</a>, 
version prior to 6.9.3-9 are prone to multiple vulnerabilities including RCE.
Here is the PoC:
<a href="/images/pp-imagetragick-2.png"><img src="/images/pp-imagetragick-2.png" alt="Private program imagetragick" /></a></p>

<p>The company was nice enough to reward those two RCE the same day.</p>

<h2 id="my-favorite">My favorite</h2>

<p>After I had seen the LevelUP 2017 video from the awesome <a href="https://twitter.com/zseano" class="flashlink" target="_blank">@zseano</a>, 
kudos to him, where he explains how to find bugs by extracting datas from Javascript files, I decided to write my own program to extract endpoints and other juicy infos from source code.
Once done, I downloaded all JS files I found from my target, and ran my script.
Needless to say that hundreds of new endpoints popped. 
One of them catched my eyes:
<code class="highlighter-rouge">/[REDACTED].php?[REDACTED]=[REDACTED]&amp;template=[REDACTED].tpl</code></p>

<p>When you’re a web developper, you know that the extension <code class="highlighter-rouge">.tpl</code> is commonly used for HTML code rendered by template engines.
Could it be a filename as a parameter???
I immediately tried the value <code class="highlighter-rouge">/etc/passwd</code>:</p>

<p><a href="/images/pp-lfd-1.png"><img src="/images/pp-lfd-1.png" alt="Private program local file disclosure" /></a></p>

<p>Ok, this is a valid bug. 
At first, I though it was a Local File Inclusion so I tried to upgrade to RCE with some tools like fimap, dotdotpwn or Kadimus and then manually but nope…
Since I didn’t know the path of the application on the server, I was not able to include any PHP file.</p>

<p>When I find a serious bug like this, I always send the report the same day.
First because I want to avoid a stupid duplicate, second because the company has to be aware of it and fix ASAP!</p>

<p>The day after, the bug was still here. 
Hmmm, well well well…
Ding Dang!
My brain had a flash, why to not try to include the PHP endpoint itself?!
Something like:
<code class="highlighter-rouge">/the_vulnerable_script.php?[REDACTED]=[REDACTED]&amp;template=the_vulnerable_script.php</code>
Guess what? I got the whole source code and it was not interpreted, so actually this was a Local File Disclosure.</p>

<p><a href="/images/pp-lfd-2.png"><img src="/images/pp-lfd-2.png" alt="Private program local file disclosure" /></a></p>

<p>Jumping from include to include, I got some config files with database credentials, API keys of 3rd party services and so on…
After digging for a while, I finally got the Graal aka the hard coded <code class="highlighter-rouge">autoload</code> file. 
Basically it’s an array with the classname as the keys and the filepath as the values, here is a basic example:</p>
<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$t_autoload</span> <span class="o">=</span> <span class="p">[</span>
	<span class="s1">'Auth'</span> <span class="o">=&gt;</span> <span class="s1">'/var/www/project/lib/User/Auth.php'</span><span class="p">,</span>
	<span class="s1">'User'</span> <span class="o">=&gt;</span> <span class="s1">'/var/www/project/lib/User/User.php'</span><span class="p">,</span>
	<span class="s1">'Article'</span> <span class="o">=&gt;</span> <span class="s1">'/var/www/project/lib/Article/Article.php'</span><span class="p">,</span>
	<span class="s1">'Comment'</span> <span class="o">=&gt;</span> <span class="s1">'/var/www/project/lib/Article/Comment.php'</span>
<span class="p">];</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>In a nutshell (Yaworsk favorite 3 words), I could access to the whole source of the application.
Not a RCE but still a nice catch :)
Some minutes later I got a script running and grabbing the files:</p>

<p><a href="/images/pp-lfd-3.png"><img src="/images/pp-lfd-3.png" alt="Private program local file disclosure" /></a></p>

<p><a href="/images/pp-lfd-4.png"><img src="/images/pp-lfd-4.png" alt="Private program local file disclosure" /></a></p>

<p>Game over!</p>

<p>I stayed in touch with the company all along the exploitation of this bug. 
I stopped my script after a few minutes, I though that would not be fair/polite and legal to download everything.</p>

<h2 id="the-last-but-not-the-least">The last but not the least</h2>

<p>Using my previous findings, I had some more endpoints in my hands. 
From here I found 1 more SQL injection, 4 XSS, and another nice one: account takeover.</p>

<p>In this request, changing my email by the email of any other user will immediately update his password by the one provided. 
No confirmation needed, I didn’t even need to be authenticated.</p>

<p><a href="/images/pp-ato.png"><img src="/images/pp-ato.png" alt="Private program account takeover" /></a></p>

<h2 id="conclusion">Conclusion</h2>

<p>“I got the swag and it’s pumping out my ovaries.”<br />
<a href="https://www.youtube.com/watch?v=PAjYwryn2qY" class="flashlink" target="_blank">https://www.youtube.com/watch?v=PAjYwryn2qY</a></p>

<p>Great thanks to <a href="https://twitter.com/Hacker0x01" class="flashlink" target="_blank">@Hacker0x01</a> and every bug bounty platforms to make this possible.</p>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://10degres.net/tags/#sqli" title="Pages tagged sqli" class="tag"><span class="term">sqli</span></a><a href="http://10degres.net/tags/#xss" title="Pages tagged xss" class="tag"><span class="term">xss</span></a><a href="http://10degres.net/tags/#subdomain" title="Pages tagged subdomain" class="tag"><span class="term">subdomain</span></a><a href="http://10degres.net/tags/#rce" title="Pages tagged rce" class="tag"><span class="term">rce</span></a><a href="http://10degres.net/tags/#upload" title="Pages tagged upload" class="tag"><span class="term">upload</span></a><a href="http://10degres.net/tags/#repository" title="Pages tagged repository" class="tag"><span class="term">repository</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://10degres.net/the-bugbounty-program-that-changed-my-life/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://10degres.net/the-bugbounty-program-that-changed-my-life/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://10degres.net/the-bugbounty-program-that-changed-my-life/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
    <div class="see-also">
	<div class="see-also-header">
		<a href="javascript:;" class="see-also-btn">See Also</a>
	</div><!-- /.see-also-header -->
	<article>
		<ul>
			
				
					<li class="entry-title"><a href="https://www.youtube.com/watch?v=BEaMhs9LmoY&list=PLIK9nm3mu-S5InvR-myOS7hnae8w4EPFV&index=11" target="_blank">LevelUP 2017 videos</a></li>
				
			
				
					<li class="entry-title"><a href="https://github.com/gwen001/pentest-tools/blob/master/extract-endpoints.php" target="_blank">My endpoints extractor</a></li>
				
			
		</ul>
	</article>
</div><!-- /.see-also -->

    

<div class="read-more">
  
    <div class="read-more-header">
      <a href="javascript:;" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://10degres.net/subdomain-enumeration/" title="Subdomain enumeration">Subdomain enumeration</a></h3>
      <p>A friend recently asked me what methods I use to find subdomains.To be honest I was confused, like *"oooohhh so much, brute force mmm... ...&hellip; <a href="http://10degres.net/subdomain-enumeration/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
	  <div class="list-item">
		  
			<h4><a href="/why-bugbounty/">&laquo; Why Bug Bounty</a></h4>
			<span>Published on March 29, 2018</span>
		  
	  </div><!-- /.list-item -->
	  <div class="list-item">
		
			<h4><a href="/massive-pwnage/">Massive pwnage &raquo; </a></h4>
			<span>Published on February 03, 2018</span>
		
	  </div><!-- /.list-item -->
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->

  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2018 Gwendal Le Coguic</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://10degres.net/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://10degres.net/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61485350-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>




	        

</body>
</html>
