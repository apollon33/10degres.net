<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Vulnerability in Wordpress Video Gallery &#8211; Gwendal Le Coguic</title>
<meta name="description" content="Gwendal Le Coguic, web developer and security researcher">
<meta name="keywords" content="sql injection, video gallery, wordpress">

<!-- Twitter Cards --><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://10degres.net/assets/img/header-background.jpg">
<meta name="twitter:title" content="Vulnerability in Wordpress Video Gallery">
<meta name="twitter:description" content="Gwendal Le Coguic, web developer and security researcher">
<meta name="twitter:creator" content="@gwendallecoguic">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Vulnerability in Wordpress Video Gallery">
<meta property="og:description" content="Gwendal Le Coguic, web developer and security researcher">
<meta property="og:url" content="http://10degres.net/vulnerability-in-wordpress-video-gallery/">
<meta property="og:site_name" content="Gwendal Le Coguic">
<meta property="og:image" content="http://10degres.net/assets/img/header-background.jpg">


<meta name="google-site-verification" content="GnoFwHUV3XNgLy4D-7XjLQ0Dbw6fKBXZnBzMn-0GBX8">



<link rel="canonical" href="http://10degres.net/vulnerability-in-wordpress-video-gallery/">
<link href="http://10degres.net/feed.xml" type="application/atom+xml" rel="alternate" title="Gwendal Le Coguic Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://10degres.net/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://10degres.net/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://10degres.net/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://10degres.net/favicon.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://10degres.net/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://10degres.net/assets/img/me.jpg" alt="Gwen photo" class="author-photo">
					<h4>Gwen</h4>
					<p>Web developer reconverted to security researcher, playing bug bounty sometimes :)</p>
				</li>
				<li><a href="http://10degres.net/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:g@10degres.net"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/gwendallecoguic" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="https://linkedin.com/in/gwendal-le-coguic-77106729" target="_blank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/gwen001" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://10degres.net/posts/">All Posts</a></li>
				<li><a href="http://10degres.net/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  
  <div class="entry-image">
    <img src="http://10degres.net/assets/img/header-background.jpg" alt="Vulnerability in Wordpress Video Gallery">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://10degres.net/vulnerability-in-wordpress-video-gallery/" rel="bookmark" title="Vulnerability in Wordpress Video Gallery">Vulnerability in Wordpress Video Gallery</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-02-12T00:00:00+00:00">February 12, 2015</time></span></h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Recently reported by Claudio Viviani, there is an SQL Injection available in this plugin who has been downloaded more than 100k. 
Developped by Apptha (again), the current version 2.7 still vulnerable and downloadable from 
the official <a href="https://wordpress.org/plugins/contus-video-gallery/" title="Wordpress Video Gallery" class="flashlink" target="_blank">Wordpress Plugin Directory</a>.</p>

<p>The hole comes from the lack of filter on the GET parameter <code class="highlighter-rouge">vid</code> in <code class="highlighter-rouge">/wp-content/plugins/contus-video-gallery/videogalleryrss.php</code> (the plugin must be enable to perform the injection):</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>case 'video':
  $thumbImageorder = 'w.vid ASC';
  $vid             = filter_input(INPUT_GET,'vid');
  $where           = 'AND w.vid ='.$vid;
  $TypeOFvideos    = $contusOBJ-&gt;home_thumbdata( $thumbImageorder , $where , $dataLimit );
break;
</code></pre>
</div>

<p>Since there is no filter specified when calling <a href="http://php.net/manual/fr/function.filter-input.php" title="filter_input">filter_input</a>, the default value is used which is <code class="highlighter-rouge">unsafe_raw</code>. 
According to the PHP documentation, <a href="http://php.net/manual/fr/filter.filters.sanitize.php" title="FILTER_UNSAFE_RAW">FILTER_UNSAFE_RAW</a> deletes chars under 32 and over 127 and converts <code class="highlighter-rouge">&amp;</code> to <code class="highlighter-rouge">&amp;amp;</code>.</p>

<!--more-->

<p>Of course, it’s not enough to protect the query crafted in <code class="highlighter-rouge">/wp-content/plugins/contus-video-gallery/front/models/videohome.php</code>:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="err">$</span><span class="n">query</span> <span class="o">=</span> <span class="s1">'SELECT distinct w.*,s.guid,s.ID,p.playlist_name,p.pid,p.playlist_slugname FROM '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_videoinfotable</span> <span class="p">.</span> <span class="s1">' w
LEFT JOIN '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_wpdb</span><span class="o">-&gt;</span><span class="k">prefix</span> <span class="p">.</span> <span class="s1">'hdflvvideoshare_med2play m ON m.media_id = w.vid
LEFT JOIN '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_wpdb</span><span class="o">-&gt;</span><span class="k">prefix</span> <span class="p">.</span> <span class="s1">'hdflvvideoshare_playlist p ON p.pid=m.playlist_id
LEFT JOIN '</span> <span class="p">.</span> <span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_wpdb</span><span class="o">-&gt;</span><span class="k">prefix</span> <span class="p">.</span> <span class="s1">'posts s ON s.ID=w.slug
WHERE w.publish=1 AND p.is_publish=1 '</span> <span class="p">.</span> <span class="err">$</span><span class="k">where</span> <span class="p">.</span> <span class="s1">' GROUP BY w.vid ORDER BY '</span> <span class="p">.</span> <span class="err">$</span><span class="n">thumImageorder</span> <span class="p">.</span> <span class="s1">' LIMIT '</span> <span class="p">.</span> <span class="err">$</span><span class="n">dataLimit</span><span class="p">;</span>
</code></pre>
</div>

<p>Rendered as:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">distinct</span> <span class="n">w</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">guid</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">playlist_name</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">playlist_slugname</span> <span class="k">FROM</span> <span class="n">wp_hdflvvideoshare</span> <span class="n">w</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">wp_hdflvvideoshare_med2play</span> <span class="n">m</span> <span class="k">ON</span> <span class="n">m</span><span class="p">.</span><span class="n">media_id</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">wp_hdflvvideoshare_playlist</span> <span class="n">p</span> <span class="k">ON</span> <span class="n">p</span><span class="p">.</span><span class="n">pid</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">playlist_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">wp_posts</span> <span class="n">s</span> <span class="k">ON</span> <span class="n">s</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">w</span><span class="p">.</span><span class="n">slug</span>
<span class="k">WHERE</span> <span class="n">w</span><span class="p">.</span><span class="n">publish</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="n">p</span><span class="p">.</span><span class="n">is_publish</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span> <span class="o">=</span><span class="mi">234</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">w</span><span class="p">.</span><span class="n">vid</span> <span class="k">ASC</span> <span class="k">LIMIT</span> <span class="mi">1000</span>
</code></pre>
</div>

<p>Here is the POC:</p>

<p><a href="/images/wordpress-video-gallery-sqli.png"><img src="/images/wordpress-video-gallery-sqli.png" alt="wordpress video gallery sqli" /></a></p>

<p>Remember that <strong>it’s not the first time that Apptha released a plugin with major vulnerability</strong>. Months ago <a href="http://blog.10degres.net/vulnerability-in-hd-flv-player/" title="HD FLV Player">HD FLV Player</a> was concerned.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://10degres.net/tags/#sql injection" title="Pages tagged sql injection" class="tag"><span class="term">sql injection</span></a><a href="http://10degres.net/tags/#video gallery" title="Pages tagged video gallery" class="tag"><span class="term">video gallery</span></a><a href="http://10degres.net/tags/#wordpress" title="Pages tagged wordpress" class="tag"><span class="term">wordpress</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://10degres.net/vulnerability-in-wordpress-video-gallery/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://10degres.net/vulnerability-in-wordpress-video-gallery/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://10degres.net/vulnerability-in-wordpress-video-gallery/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
    <div class="see-also">
	<div class="see-also-header">
		<a href="javascript:;" class="see-also-btn">See Also</a>
	</div><!-- /.see-also-header -->
	<article>
		<ul>
			
				
					<li class="entry-title"><a href="http://www.homelab.it/index.php/2015/02/11/wordpress-video-gallery-2-7-sql-injection/" target="_blank">Original post by Claudio Viviani</a></li>
				
			
				
					<li class="entry-title"><a href="https://www.apptha.com/" target="_blank">Apptha official website</a></li>
				
			
		</ul>
	</article>
</div><!-- /.see-also -->

    

<div class="read-more">
  
    <div class="read-more-header">
      <a href="javascript:;" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://10degres.net/subdomain-enumeration/" title="Subdomain enumeration">Subdomain enumeration</a></h3>
      <p>A friend recently asked me what methods I use to find subdomains.To be honest I was confused, like *"oooohhh so much, brute force mmm... ...&hellip; <a href="http://10degres.net/subdomain-enumeration/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
	  <div class="list-item">
		  
			<h4><a href="/weevely/">&laquo; Weevely</a></h4>
			<span>Published on February 19, 2015</span>
		  
	  </div><!-- /.list-item -->
	  <div class="list-item">
		
			<h4><a href="/dvwa-file-upload/">DVWA - File upload &raquo; </a></h4>
			<span>Published on February 11, 2015</span>
		
	  </div><!-- /.list-item -->
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->

  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2018 Gwendal Le Coguic</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://10degres.net/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://10degres.net/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61485350-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>




	        

</body>
</html>
